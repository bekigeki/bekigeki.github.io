---
title: "Sport-Veranstaltungen im Rahmen von \"BEWEGTE KINDER = GESÜNDERE KINDER\""
subtitle: Stand 2023-05-05
date: 2023-04-25
lang: de
editor_options: 
  chunk_output_type: console
author:
  - name: Toni Wöhrl
    affiliation: Universität Erfurt
    appendix-cite-as: false
  - name: Florian Bähr
    affiliation: Universität Erfurt
abstract: |
  Die folgende Seite fasst die vergangenen und aktuellen Sport-Veranstaltungen "Talentiade" und "Tage des Sports und der Gesudheitsförderung" im Rahmen des Programmes "Bewegte Kinder = Gesündere Kinder" in Thüringen zusammen. 
citation:
  type: webpage
appendix-cite-as: "display"
license: "CC BY"
csl: nature.csl
---

```{r, echo=FALSE,results=FALSE}
knitr::opts_chunk$set(echo=FALSE,cache=FALSE,results=FALSE)
```


# Setup and data {.hidden .unlisted}


```{r}
library(tidyverse)
library(dplyr)
library(kableExtra)
library(readxl)
library(sf)
library(leaflet)
library(leaflet.extras)
library(leafpop)
library(htmlwidgets)
library(webshot)
library(readxl)
library(reactable)
library(ggplot2)
```


```{r,eval=FALSE}
d <- readxl::read_excel("/Users/tw/NextcloudUniErfurt/bekigeki/Urdata/data/events.xlsx") 
arcgis <- d %>%
  tidygeocoder::geocode(address = Place, 
          method = 'arcgis', 
          lat = latitude , 
          long = longitude,
          unique_only = TRUE)

d_arcgis <- merge(arcgis,d,by.x="address",by.y="Place",no.dups=TRUE)

# check

leaflet(d_arcgis)%>%
  addProviderTiles(providers$OpenTopoMap,
                   options = providerTileOptions(opacity=.2)) %>%
  # arcgis (rote Punkte)
  addCircleMarkers(lng=~longitude,
                   lat=~latitude,
                   popup=popupTable(d_arcgis),
                   radius = 1.5,
                   color="red",
                   stroke = FALSE,
                   fillOpacity = 1)

write.csv(d_arcgis,"./data/events.csv")
```


```{r}
d <- read.csv("./data/events.csv")

# Kreise Deutschlandweit
kreise <- sf::st_read("./data/sg.geodatenzentrum.de/2023-01-24/vg5000_12-31.utm32s.shape.ebenen/vg5000_ebenen_1231/VG5000_LAN.shp")

# Kreise Thueringen
kreise_th <- subset(kreise, grepl("^16",as.character(kreise$ARS)))
#plot(kreise_th$geometry)
kreise_th_t<- st_transform(kreise_th$geometry, crs = "+proj=longlat +datum=WGS84")


ts_geo<- st_as_sf(d, 
                 coords = c("longitude", "latitude"),
                 crs = 4326,
                 agr = "constant"
                 )|>
  rename(Veranstaltung=Type)
```



# Standorte und Anzahl

```{r,results=TRUE}
p1<-ggplot(ts_geo) + 
 geom_sf(data=kreise_th,fill="white", )+
   geom_sf(size = 2,  
          aes(color=Veranstaltung),
           show.legend = FALSE
         #  color="#469cdd" # blau
         #  color="#d22c4a"
        #   
           ) +
 # theme(legend.position = "bottom")+
  scale_color_manual(values=c("#009ee3","#9dc041"))+
  facet_wrap(vars(Year),nrow=2)+
  theme_void()
```


```{r, results=TRUE}
#| fig-cap: "Räumliche Verteilung und zeitliche Entwicklung der Sport-Veranstaltungen"
#| cap-location: margin

d$Type <- trimws(d$Type)


p2<-ggplot(d,aes(x=Year,fill=Type,group=Type))+
  geom_bar()+
  annotate("text", x = 2020.5, y = 7.5, label = "COVID-19\nPandemie",size=3)+
  scale_fill_manual(values=c("#009ee3","#9dc041"))+
  xlab("Jahr")+
  ylab("Anzahl an Sportveranstaltungen")+
  theme_bw()+
  theme(legend.position = "top")+
 guides(fill=guide_legend(title=""))

ggpubr::ggarrange(p1,p2,nrow=1,common.legend = TRUE)

```

# Tabelle

```{r,results=TRUE}
d|> 
  mutate(Datum = lubridate::ymd(paste0(Year,"-",Month,"-",Day)))|>
  rename(Ort=address,
         Jahr = Year,
         Veranstaltung=Type)|>
  mutate(Jahr = trimws(Jahr))|>
  select(Datum,Ort,Veranstaltung,Jahr)|>
  arrange(Jahr,Datum)|>
  reactable(pagination=TRUE,
            searchable = TRUE,
            sortable = TRUE,
          #  filterable=TRUE,
            groupBy = c("Jahr"))
```



# Updates
- 2023-05-09: Entfernung BibTeX-Zitation, Figure-Caption an Rand, License
- 2023-05-08: Zusammenfassung, Umstrukturierung
- 2023-05-03: COVID-19-Pandemie Annnotation in Balkendiagramm
- 2023-04-25: Erstellen der Seite
